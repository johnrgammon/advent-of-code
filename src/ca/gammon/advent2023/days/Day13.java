package ca.gammon.advent2023.days;

import ca.gammon.advent2023.days.utils.Utils;

import java.util.*;
import java.util.stream.Collectors;
import java.util.stream.IntStream;

public class Day13 {

    private static final int EXPECTED_RESULT_DEMO_PART_ONE = 405;
    private static final int EXPECTED_RESULT_DEMO_PART_TWO = 400;
    private static final int EXPECTED_RESULT_PART_ONE = 37113;
    private static final int EXPECTED_RESULT_PART_TWO = 30449;

    private static final String DEMO_DATA;
    private static final String DATA;
    static {
        //region demo_data
        DEMO_DATA = """
                #.##..##.
                ..#.##.#.
                ##......#
                ##......#
                ..#.##.#.
                ..##..##.
                #.#.##.#.

                #...##..#
                #....#..#
                ..##..###
                #####.##.
                #####.##.
                ..##..###
                #....#..#""";
        //endregion demo_data
        //region data
        DATA = """
                ##..#..#......#
                .........#..#..
                .####.#.######.
                #....#.###..###
                ..##..#.#.##.#.
                ######...#..#..
                #.##.#.#.#..#.#
                #....#..######.
                .#..#...#.##.#.
                #....#....##...
                .#..#.#..####..
                ......#.######.
                ##..##.#.####.#
                
                .#...##..
                ..##.#.##
                .#.###...
                ###..#.##
                ##.#.####
                ..#.#..##
                .###...##
                .#...#.##
                #####.#..
                ...#..###
                ###.##.##
                ####...##
                ####..###
                ###.##.##
                ...#..###
                
                #####...####.#.
                ##..###..#..#.#
                ...#.###.....#.
                ...#.###.....#.
                ##..###..#..#.#
                #####...####.#.
                ##....####.....
                #..##.....#..#.
                #..##.....#..#.
                ##....####.....
                #####...######.
                ##..###..#..#.#
                ...#.###.....#.
                
                #..##...#
                #..#..###
                #..#..###
                #..##...#
                .##..#.#.
                .....###.
                #..#.##.#
                ...#..###
                .##.#..##
                .##.#.#.#
                #####.#..
                
                ######.#.#.#...
                .#..#.#.##...#.
                ...#....#.#.#..
                #.##.#.#.....#.
                .......##.#.###
                #######.##.#..#
                ......##...##..
                #.##.#....#.#..
                #.##.#....#.#..
                
                #...#..##..
                .##..######
                ....###..##
                .#..#..##..
                .####.####.
                ###.##....#
                .#..##...##
                ###.#..##..
                #.#.#......
                .####......
                ....#.####.
                ..##..#..#.
                ..#.#.####.
                ..#.#.####.
                ..##..#..#.
                
                #...#.#.##.#.#...
                ###.#..#..#..#.##
                #...##.####.##...
                #.....#.##.#.....
                ...#####..#####..
                ##..#.######.#..#
                ###.##.#..#.##.##
                ...#..#.##.#..#..
                ....#........#...
                #..##.#.##.#.##..
                #................
                
                ...##.###.#
                ...##.###.#
                ##..#....#.
                ##.....#.##
                #.##..#.#.#
                ..##...#.#.
                ...#####..#
                
                .##.##.#.##..
                #..#.#.#.....
                ####.###..#.#
                ####.####.###
                #..#.#####.##
                #..#.#....###
                #..#.#....###
                #..#.#####.##
                ####.####.###
                ####..##..#.#
                #..#.#.#.....
                .##.##.#.##..
                .....##.#.#..
                ####..#.#.##.
                #####.#...###
                #####.#...#..
                #..#...####.#
                
                #..#.#...#...##..
                ...#...#..#..##..
                #..####.#.#.####.
                ..#####..#.##..##
                ..#...####.##...#
                .#.#########....#
                .#.#########....#
                
                #..#...#.#.#...#.
                #.####...###.#.#.
                #.....##...##.#.#
                ##.##....#....#..
                #.....##....#....
                ..##.##.#...#..#.
                ..##.##.#...#..#.
                #.....##....#....
                ##.##....#....#..
                #.....##...##.#.#
                #.####...###.#.#.
                #..#...#.###...#.
                ......#.#..##....
                ......#.#..##....
                #..#...#.###...#.
                #.####...###.#.#.
                #.....##...##.#.#
                
                ....#..
                #.##...
                #.###..
                #...##.
                .##..##
                .##..##
                #...##.
                #.###..
                #.##...
                
                ##.##.#..
                ..#..#..#
                ...#####.
                ..#....##
                ##.##.##.
                ##.##.##.
                ..#...###
                ...#####.
                ..#..#..#
                
                ...####.....#####
                .#......#.####..#
                .#########.##....
                ####..#####.#####
                ..######..#...##.
                #.##..##.#....##.
                ....##....##.....
                #........#.#.....
                ....##.....#.....
                ...#..#.......##.
                #.######.##......
                .##....##.###.##.
                ...####...#..#..#
                
                .#...###..###...#
                ##..##.#....##..#
                .#.#.########.#.#
                .######.##.######
                .##.#...##...#.##
                .#...########...#
                .#.#...#..#...#.#
                #..#....##....#..
                #..####.##.####..
                #.##..##..##..##.
                ..#...#.##.#...#.
                #..#..........#..
                #..#..........#..
                
                ....#..###....#
                #..#..#..#....#
                #..##.....####.
                .##..#..#..##..
                ####.###..####.
                ###.#.##.#.##.#
                .##..#..##....#
                #####.###..##..
                ####..#...#..#.
                #..#....#..##..
                #..####..##..##
                ......#.##.##.#
                .##...#########
                .........#.##.#
                .##..######..##
                #..####..#....#
                .##.####..#..#.
                
                #..#.##...#.##.
                ###.##.##.#...#
                ##.########.#.#
                .#.#.##.#...###
                .#.#....####...
                .#.#....####...
                .#.#.##.#...###
                ##.########.#.#
                ###.#..##.#...#
                #..#.##...#.##.
                #..#.##...#.##.
                
                .##..####..##..
                ####..##..#####
                .#.#.####.#.#..
                ..##..##..##...
                #....#####...##
                ####.#..#.#####
                ##..........###
                #.#.#....#.#.##
                #...##..##...##
                .##.##..##.##..
                ..##..##..##...
                ....#.##.#.....
                ###.######.####
                
                ########..#.##.#.
                ######..######.##
                #.##.#.#.###.###.
                #....#.#.####.###
                #....##..#..###..
                ......##.##..###.
                ..##..#..#.###..#
                ..##..#.#.##...#.
                ##..######..##..#
                ##..######...#..#
                ..##..#.#.##...#.
                ..##..#..#.###..#
                ......##.##..###.
                #....##..#..###..
                #....#.#.####.###
                #.##.#.#.###.###.
                ######..######.##
                
                #.####..##..#
                #.#.#........
                .#.###...#..#
                #...#..##....
                ...#.#.###..#
                #..####.#....
                #####.#..#..#
                .##..####....
                .....#...#..#
                ##.#...#.####
                .....###.....
                ###..##.#....
                .#..##.#.####
                #...#..#..##.
                ##...#.......
                .#...#.......
                #...#..#..##.
                
                ...#..##.
                ..#.#.#.#
                ######.##
                #####.###
                ..####...
                ######..#
                ######..#
                ..####...
                #####.###
                ######.##
                ..#.#.#.#
                ...#..##.
                #..###.##
                ####..##.
                ...#.#..#
                ...###.#.
                ..##.##.#
                
                .####.....#.#
                ........#.###
                ##..##...##.#
                ..##...####..
                ..##...####..
                ##..##...##.#
                ........#.###
                .####.....#.#
                ######.##.#..
                .#..#.####.#.
                ##..####.##.#
                #.##.##..#...
                ##..########.
                ##..##.##.#.#
                .####....#.#.
                .....#.#.#.#.
                .#..#....#.##
                
                #..########..##
                #............##
                #.##########.##
                .#.#.####.#.#..
                ##.#......#.###
                .#.###..#.#.#..
                ###.######.####
                #.##.####.##.##
                ##.##....##.###
                #.#.#.##.#.#.##
                #.##......##.##
                
                .#......#..####.#
                #.#.#####.#.###..
                ##..##.#..#...##.
                .##.#..###...#..#
                .##.#..###...#..#
                ##..##.#..#...##.
                #.#.#####.#.###..
                .#......#..####.#
                #..##.#.##..#.#..
                #..##.#.##..#.#..
                .#.....##..####.#
                #.#.#####.#.###..
                ##..##.#..#...##.
                
                .#....#......#.
                ..#.##.######.#
                ...#.#..#..#..#
                ##..#.###..#.#.
                ##.............
                ##..#.########.
                ..#.##..####..#
                ..#.##..####..#
                ##..#.########.
                ##.............
                ##..#.###..#.#.
                
                ####.##
                ###..##
                #.#####
                ##..#..
                #......
                ####.##
                #.#....
                ..###..
                ..#####
                #.#....
                ####.##
                #......
                ##..#..
                #.#####
                ###..##
                ####.##
                #####..
                
                ###.##.....
                ##.##..#..#
                ##.##.....#
                ###.##.....
                #####...#..
                ..#########
                ########.##
                ##.###...##
                ..#..#..#.#
                ..##...##..
                ...####.#.#
                
                #.##...#....#
                ##....##....#
                ##..##..#..#.
                ##..##..#..#.
                ##.....#....#
                #.##...#....#
                .##.....####.
                #####..#.##.#
                #.####.#.##.#
                .#.##.#.#..#.
                #...#.#..##..
                ###..##.####.
                .#####.......
                
                #..##.#
                #.###..
                #.###..
                #..##.#
                .##.##.
                ...#...
                #..###.
                #..##..
                #..#..#
                #..#..#
                #..##..
                #..###.
                .#.#...
                
                .###.##
                .##.###
                ##.....
                ##..#..
                .##.###
                .###.##
                #...###
                
                ..##..#.##.
                .#..#.....#
                .#..#.##.#.
                ######.####
                ..##.......
                ..##.......
                ######.####
                .#..#.##.#.
                .#..#.....#
                ..##..#.##.
                #........#.
                ########..#
                ##..##..##.
                
                ..######.....#...
                ...........##.##.
                .#.####.#....####
                .#..##..#.####..#
                ####..#####......
                ###########.#.##.
                .#..##..#..###..#
                ###.##.###...####
                #..####..##.#####
                
                ###.#####..##..
                ...........##..
                .#.##...#..##..
                .#...##.##....#
                .....#.###.##.#
                ..#####..#....#
                ##..###..##..##
                ####.##...#..#.
                .#.##..##.#..#.
                .####...##.##.#
                ...#.##..######
                ..#..##..######
                ..#..###..####.
                ..#..###..####.
                ..#..##..######
                .#.#.##..######
                .####...##.##.#
                
                ..##.##..#.....
                ..##.##..#.....
                .##...##.##...#
                .....##..##.##.
                #####.####..##.
                .#......#.##..#
                ....##..###.##.
                
                #..####
                ##.##..
                ..#.#..
                ..#.#.#
                ..#...#
                .....#.
                .#.#...
                .#.#...
                .....#.
                ..#...#
                ..#.#.#
                
                #.###.#
                #####.#
                .##..#.
                .##..#.
                #####.#
                #.###.#
                ...####
                .#.##.#
                ......#
                
                #.##..##.####.#
                ..######..##..#
                ###....###..###
                ...####...##...
                #........####..
                ###.######..###
                ##.####.##..##.
                ##..##..######.
                .#......#.##.#.
                #.#....#.####.#
                ##......######.
                ..#....#..##..#
                ###.##.########
                .#......#.##.#.
                .#......#....#.
                
                .##........#.
                ...#.##.##..#
                .#..###..####
                ...#.....####
                .#....##..###
                #..#...#.#...
                #.#...#.##.#.
                #.#...#.##.#.
                #..#...#.#...
                ##....##..###
                ...#.....####
                .#..###..####
                ...#.##.##..#
                .##........#.
                .##........#.
                ...#.##.##..#
                .#..###..####
                
                ....##....###
                .########....
                ##.#..#..####
                #...##...##..
                #........#.##
                ###.##.####..
                ..##..##..###
                ..#....#.....
                #..####..####
                ##.####.##.##
                ##..##..##.##
                
                ########.#.#.##.#
                ###..####.##....#
                ##....##...##..##
                #......#.########
                #.####.##.##.##.#
                #......##.#.#....
                #......##....##..
                .######.##.......
                ##....####.#.##.#
                #..##..#.###....#
                ...##...#....##..
                .######....######
                ##.##.##.#...##..
                #..##..#.#.##..##
                .#....#.##...##..
                
                ###.#...####...#.
                #..#.##..##..##.#
                .##...##....##...
                #####......#...##
                #####......#...##
                .##...##....##...
                #..#.##..##..##.#
                
                ####..#.##.#.
                .#..##.####.#
                #..#.#.####.#
                #..#.#.####.#
                .#..##.####.#
                ####..#.##.#.
                .###.#.####.#
                ##....#......
                ####.#..##..#
                ##..#...##...
                ...##.#....#.
                ##.##########
                ###.####..###
                
                #..######..#...
                .###....###..##
                .#.####.#.#..##
                .###.##.###..##
                ..###..###..###
                .#...##...#..##
                ###.#..#.###...
                #.#.#..#.#.##..
                #..######..##..
                ...#.##.#...###
                ..#......#.....
                
                ......##.#.
                ##.#..#....
                ##.#..#....
                ......##.#.
                #.#.#.##.#.
                ..#.#.###.#
                #####..##..
                ##.###.#..#
                ..#.##...#.
                
                ##......###.###
                ##......###.###
                #.##..##.##..#.
                .##....##.###.#
                ..........#.#.#
                ..######...#..#
                ##.####.##...#.
                ..#....#..##..#
                .###..###..##.#
                .#......#.##.#.
                .#......#.##..#
                .#.####.#..#..#
                ###.##.######..
                ##..##..#.#....
                .##.##.##...##.
                
                .#....#.#..#.
                ...##....##..
                ##.##.##....#
                #.#..#.#.##.#
                .######..##..
                ###..####..##
                ##.##.###..##
                ..#..#..#..#.
                .#.####.#..#.
                .#....#......
                #..##..##..##
                .#....#..##..
                ###..###....#
                
                ##.##.##.###....#
                .######.####....#
                #......##.##.#..#
                ..#..#..##.##..##
                .#....#..#.#.##.#
                #..##..#..#######
                ..#..#...##.#..#.
                ...##.....#######
                #.####.#.#.##..##
                ##....#######..##
                .######..##.#..#.
                .##..##..#..#..#.
                ###..####...#..#.
                .#.##.#..#.#....#
                .######.#.###..##
                .........####..##
                ##.##.##.........
                
                ....##.##.#.#..##
                ####.##.###.####.
                #..##..#.####..##
                .##....##.#.##.##
                #..#...#.#.##....
                .##......##..#.##
                #..#.##...#.#.#..
                
                ....##.##
                ....##.##
                ....#....
                ..###.#..
                ##.#.####
                ....#.#..
                ..#......
                ###....#.
                #...#.#.#
                
                .....##...###.#.#
                .##.#.##.....#...
                .##.#.##.....#...
                .....##...###.#.#
                #.######...###...
                ..#.#....#.##.#.#
                ##########.#..#.#
                ..#..#....###..#.
                ...##.#.##..###..
                #####.#.......##.
                ..#..#.#.#...##.#
                ..#..#.#.#...##.#
                #####.#...#...##.
                ...##.#.##..###..
                ..#..#....###..#.
                
                .#.##.#.....#....
                #.#..#.#.#.##.#.#
                ###..####......##
                #.####.#..#..#..#
                ..#..#..###..###.
                ..####.....##....
                ##....####....###
                
                ##..#.##......#
                ..#.##.#.##.###
                #..#......#.###
                .##.##.#.....#.
                #.#..##.##.##.#
                #.#..##.##.##.#
                .##.##.#.....#.
                #..#......#.###
                #.#.##.#.##.###
                ##..#.##......#
                #....###.##.#..
                #....###.##.#..
                ##..#.##......#
                #.#.##.#.##.###
                #..#......#.###
                
                ..##.#...#.##
                .#.##.#..#...
                #..##..##..##
                #......###...
                ...........##
                .#.##.#.###..
                #.#..#.###...
                .#.##.#.##.##
                ##....##.####
                .#.##.#....##
                ##.##.##..#..
                #.####.#.####
                #.####.#.#.##
                .#....#.##.##
                ..#..#..##.##
                #..##..##....
                #......#.#.##
                
                ..#..###.....
                .##.#.#...#.#
                ..######.#.#.
                ...#####.#.#.
                .##.#.#...#.#
                ..#..###.....
                #..#######...
                .#..#.#......
                ..####.#..#..
                ...#..##.####
                .####.......#
                #...#.##..#.#
                ...####.##.##
                ...####.##.##
                #...#.##..#.#
                
                ...###.
                .#..###
                .#..###
                ...###.
                ..#.#..
                .###..#
                ..#.#.#
                .#.#.#.
                .###..#
                .###..#
                .#.#.#.
                #.#.#.#
                .###..#
                ..#.#..
                ...###.
                
                ..######.....
                ##########..#
                ...####......
                #.######.#..#
                #..#..#..#..#
                #.##.###.#..#
                ##..##..##..#
                ##.####.##..#
                ##.####.#####
                #.#.##.#.#..#
                .#..##..#.##.
                #...##...####
                ..######.....
                ##.####.##..#
                ..........##.
                
                ##.##.###.#......
                #..##..#.#..####.
                #......###.#....#
                #########.##....#
                ...##.....#######
                #..##..#..#......
                #......####.#..#.
                #..##..#..#......
                .##..##.#..#.##.#
                ..#..#...#.##..##
                ...##....#####.##
                ##########.#....#
                ##.##.#####..##..
                #.####.######..##
                ###..#######.##.#
                #......#..#.#..#.
                ..#..#......####.
                
                .#..##.##..###.
                .#.###.##..###.
                #...#...#####..
                ...##.####...##
                ....#.#####.#.#
                ##.#..#.###.#..
                .#.##.####..##.
                ##.#...##.##.#.
                ....######.####
                ....#.#.##..###
                ..##...#......#
                #####...####.##
                #####...####.##
                ..##...#......#
                ....#.#.##..###
                ....######.####
                ##.#...##.##.#.
                
                #..##.###
                .##.....#
                .##.##..#
                ###..####
                #####.#.#
                ......#.#
                #..##.#..
                #..##.#..
                ......#.#
                #####.#.#
                ###..####
                .##.##..#
                .##.....#
                #..##.###
                #..######
                
                ..#.#.#..#.#.
                ..#.#.#..#.#.
                #...#.#..#.#.
                .###.#..#..#.
                .#.#..#.#.#..
                #.....#...###
                ##.##.#####..
                ##.##.#####..
                #.....#...###
                .#.##.#.#.#..
                .###.#..#..#.
                
                ####...#.#.
                ####...#.#.
                #..#..#..##
                .....#..###
                #..#.#..###
                .........#.
                .....###.##
                ######.#...
                #..##.###.#
                .........#.
                ..#..#.#.#.
                #######.##.
                ####.#..#.#
                
                #..###.
                #..###.
                .....##
                ##.#...
                #.#.#..
                .###.#.
                #.##.##
                ##..##.
                ..###.#
                ...###.
                .#.###.
                
                ############...##
                ##..####..##.#...
                ##..####..##.##..
                .####..####..#.##
                ..##....##..##.#.
                .####..####.#..#.
                ..............##.
                #..........#.##.#
                ##############.#.
                .#..#..#..#.#.#.#
                ............#.#.#
                ..##....##..###..
                #....##....#.###.
                ##############.##
                .#..#..#..#.#...#
                
                .##......#.####
                ....###..###.##
                .....######....
                ....#..##.##...
                ######....#.###
                #..###.##....#.
                ########.#.###.
                #..#####.#..###
                .##..#...####..
                .##....##..####
                #...##.##.###..
                .##...#..######
                #..#.#.#.#.#...
                .##...#..#....#
                .##...#..#....#
                
                ##.#.##.#.###
                .#.##..##.#.#
                #.#..##..#.#.
                ###.#..#####.
                #.#.#..#.#.#.
                ##.######.###
                #.##....##.#.
                #.##....##.#.
                ##.######.###
                
                ###..#####.##
                ###..#####.##
                .....###..###
                ...##..###...
                ##.#.##.##.##
                ..##.....#.##
                #.###........
                #...##...##.#
                #.####.##.#..
                #.#..###.####
                .#.#.#####...
                #.##.##.##...
                ####...####..
                #####....####
                .#.##.##.#...
                .##.##..##...
                .#.#...##.#..
                
                .###..###
                .#.#....#
                .#..##..#
                .#......#
                ...#..#..
                ##..##..#
                ####..###
                ##.#..#.#
                #.##..##.
                #.##..##.
                ##.#..#.#
                ####..###
                ##..##..#
                
                ###...#....
                ...##.#.#.#
                ..#########
                ..##....#.#
                ..#######.#
                ..#....##..
                ..#....###.
                ..#######.#
                ..##....#.#
                
                ####......#...###
                #.#..#..##..#..#.
                ##.##..####..##.#
                ..###...##...###.
                .######....######
                ..#####....#####.
                #.###...##...###.
                .#......##......#
                ...#..######..#..
                ...#..######..#..
                .#......##......#
                
                ...#..#.###
                ##.####....
                ...##..####
                ###...#....
                ..#..#...##
                ##..#.##...
                ...##...##.
                .......####
                ####..###.#
                .....#.#..#
                ##....#....
                #######.###
                ##.####.###
                
                #.#..#...
                ..##..#..
                ..##..#..
                #.#..#...
                .####....
                ##..#.###
                ...##....
                ...#...##
                ..#..####
                .#.##...#
                ....#....
                
                ..#####.....##.
                #.##..#....##..
                ........####..#
                ......#.###..##
                ....###....##.#
                ....###....##.#
                ......#.###..##
                ........####..#
                #.##..#....##..
                ..#####.....##.
                .##.#..#.#.#.##
                .##.#....#.#.##
                ..#####.....##.
                
                .#.#.#.##
                .#.###.##
                .##...#..
                ##.##.##.
                ##.#..#..
                ..#..#.#.
                ##.#.#.##
                ##.#.#.##
                ..#..#.#.
                
                ..#.#####
                ##...#..#
                ##.###..#
                ######..#
                ##...#..#
                ..#.#####
                .#.#.....
                #.....##.
                ...#.####
                ####.####
                ##.......
                #..#.#..#
                ...##.##.
                #.#.##..#
                ###......
                ....#####
                ..##..##.
                
                ...##...#
                ...######
                ...##....
                ###..#.##
                ##.#.#.##
                .#...#.#.
                ..#.#.###
                .....##..
                ###.#....
                ##.#.#.#.
                ##.#.#.#.
                
                ....#.....#..
                #..##.#....#.
                ##...........
                ..##.##...##.
                .###..#..###.
                ##.########.#
                ##..###....##
                ###.##..#.##.
                ###.##..#.##.
                ##..###....##
                ##.########.#
                .###.....###.
                ..##.##...##.
                ##...........
                #..##.#....#.
                ....#.....#..
                ....#.....#..
                
                ..##.#.#.
                #####.#..
                #...####.
                ##.###...
                ##....#.#
                ##.#.#...
                ...#####.
                ##..#...#
                .....###.
                ###..##.#
                ###.#.###
                ###.#.###
                ###..##.#
                
                ..#.###
                .....#.
                ..#...#
                ..#..##
                ####.##
                ###.#.#
                ###.#..
                ####.##
                ..#..##
                ..#...#
                .....#.
                
                .###.#.#.##.#..
                #.####..##..#.#
                #.####..##..#.#
                .###.#.#.#..#..
                ....#...#..##.#
                ..####.##.#...#
                ##..#.#..#..##.
                ###..#...#.....
                ###..#...#.....
                
                #...#.....##.
                #.###.#..####
                ..###.######.
                .#..####..##.
                .#..####..##.
                ..###.######.
                #.###.#..####
                #.........##.
                .##.##.###...
                #.##..#####..
                ##..######..#
                ###.#...#....
                .#.#.########
                ###......###.
                ....######.#.
                .###.##.##.#.
                .###.##.##.#.
                
                #..#..#....#..#
                ..###.#.##.#.##
                ##.###......###
                ##...########..
                .....#.........
                #...###....###.
                #...###....###.
                
                .#..#....#..#..
                #....#..#####..
                .####.###..##..
                #....#####.##..
                ..##.......#.##
                .......#.##..##
                ##..###..###...
                .###....#.#.#..
                .#..#...##.....
                #....#..##.####
                ##..###.####.##
                ..##..#...#.#..
                .........#..###
                
                .####..
                #...#.#
                ..##..#
                #..###.
                #..###.
                #.##..#
                #...#.#
                .####..
                ..##.##
                ..##...
                #....#.
                #.#..#.
                #.#..#.
                
                #####...#..##
                #.###...#..##
                .#####.#.#...
                .##.##..#####
                ....##.###...
                ..#.#.###.###
                .##....##..##
                ##..#.###.###
                ##...###.#...
                .#.##.#.#..##
                .#.#...#.####
                #....#...#...
                ...##..##..##
                
                .....#.#.....
                ....##.......
                #..#.#.##....
                #####.##.....
                #....####.##.
                #..####...##.
                #..###.#..##.
                ....##..#####
                #####.###....
                ....#.###....
                ####.#...#..#
                #######......
                ....#.##.####
                .##....#.#..#
                ....###.##..#
                
                ##.####......##.#
                ....#.###.#...##.
                ....#.###.#...##.
                ##.####......##.#
                .##..#.##...#.###
                .#.#.#...#...#...
                #.##.#..##.#.#.#.
                #.##.#.###.#.#.#.
                .#.#.#...#...#...
                
                #####..####..####
                ...###..##..###..
                ..##..........##.
                ##.#..##..##..#.#
                ##....#.##.#....#
                ##.#.#..###.#.#.#
                ..#.###....###.#.
                ..##..........##.
                ..###...##...###.
                ....#.##..##.#...
                .....#......#....
                
                .####..#..#..##
                ..##...#..#....
                ......###...###
                ......##.##..#.
                #....#.#.#.#...
                ######.###...##
                .####.#.#..##.#
                .......#.#..#..
                .......#.#..#..
                .####.#.#..##.#
                ######.###...##
                #....#.#.#.#...
                ......##.##.##.
                
                #.#..##.#.#..
                .#..##..#..##
                .#..##..#..##
                #.#..##.#.#..
                ..#..#...#.#.
                .#...#.#.###.
                #.#####.#.##.
                #...#...#.#..
                #...#...#.#..
                #.#####.#.##.
                .#...#.#.###.
                ..#..#...#.#.
                #.#..##.#.##.
                
                #..##......##..#.
                #..##......##..#.
                .#.#.#.##.#.#.#.#
                #..#.######.#..##
                .#..##.##.##..#.#
                #...#..##..#...#.
                #.############.#.
                #..##.#..#.##..##
                #..###....###..##
                ##.#...##..##.###
                .##.##....##.##..
                
                ..###.#.##.#.###.
                .##.##..##..##.##
                .##.##..##..##.##
                ..###.#.##.#.###.
                .##..#.####.#..##
                ###.##..##..##.##
                ###.#.#.##.#.#.##
                .#..............#
                #...###.##.###.#.
                ###...#....#...##
                .##..#..##..#..##
                ..#..##....##..#.
                ..#.#.######.#.#.
                ###..##.##.##..##
                ..#..#.#..#.#..#.
                
                ###.##.##
                ##..##..#
                #.######.
                #.######.
                ##..##..#
                ###.##.##
                .###..###
                #.#....#.
                ..#.##.##
                
                ....#.##..#
                ......#.##.
                #.####.#..#
                #.####.#..#
                ......#.##.
                ....#.##..#
                .#.##.#..#.
                .##..##....
                #....##.##.
                
                .##...##.#.
                .#.##...##.
                #..#####.##
                #..#####.##
                .#.##...##.
                .##...##.#.
                .#..###...#
                ###.##.##.#
                #...##.#.##
                #...##.#.##
                .##.##.##.#
                .#..###...#
                .##...##.#.
                
                .##...##.
                .##...##.
                ##..###.#
                ##.#.#..#
                .....#...
                #..#.##.#
                ........#
                ..##.###.
                ..##.###.
                ........#
                #..#.##.#
                .#...#...
                ##.#.#..#
                ##..###.#
                .##...##.
                
                ####..#..##.##.##
                ....#.##.........
                ....#...#.######.
                .....##..##....##
                .....####........
                ####..#...##..##.
                ....###.##.#..#.#
                #####.....##..##.
                .##.....#...##...
                .##.##.#..######.
                #..#####..#.##.#.
                #..######.##..##.
                ..#.#.#.#.######.
                .##...#..##.##.##
                ####..####.####.#
                
                #...#.#
                #..#.##
                ##..###
                ##..##.
                #..#.##
                #...#.#
                .#....#
                #..##.#
                ...#.#.
                ###...#
                ##..###
                .#####.
                .#####.
                ##..###
                ###...#
                
                ##.##..##.##.#..#
                .##..##..#..##..#
                #############...#
                ....#..#........#
                #..##..##..#.##..
                #..#....#..######
                #....##....###.##
                ###.####.#####..#
                .#..####..#.#.###
                ##..#..#..###..#.
                ..##.##.##...##.#
                .##..##..##.....#
                ...............#.
                ...............#.
                .##..##..##.....#
                ..##.##.##...##.#
                ##..#..#..###..#.
                
                #.#######
                ##.#...##
                #..##..##
                #..#.##..
                ##.##..##
                ###.#####
                ###.#####
                ##.##..##
                #..#.##..
                #..##..##
                ##.#...##
                #.#######
                ..#.#.#..
                #...#.##.
                .#.#..#..
                .#.##..##
                #.#..####
                
                .......#.#...####
                ....#..#....#.##.
                ..##...#...######
                ##.#....#.##.####
                ##..##...#####..#
                .##...#####.#####
                .####..##.#...##.
                #..#..#####..#..#
                #..#..#####..#..#
                .####..##.#...##.
                .##...#####.#####
                ##..###..#####..#
                ##.#....#.##.####
                ..##...#...######
                ....#..#....#.##.""";
        //endregion data
    }

    private static class Valley {
        private final List<String> horizontals;
        private final List<String> verticals;
        private final List<Integer> startsHorizontal;
        private List<Integer> startsVertical;
        private List<Integer> smudgeStartsVertical;
        private int horizontalCount;
        private int verticalCount;

        public Valley(String dataStr) {
            this.horizontals = new ArrayList<>();
            horizontals.addAll(Arrays.asList(dataStr.split("\n")));

            this.verticals = new ArrayList<>();

            this.startsHorizontal = getMatchedStarts(horizontals);
        }

        public void loadVerticals(boolean isSmudged) {
            int rowWidth = horizontals.get(0).length();
            IntStream.range(0, rowWidth)
                    .mapToObj(col -> {
                        StringBuilder column = new StringBuilder();
                        for (String horizontalLine : horizontals) {
                            column.append(horizontalLine.charAt(col));
                        }
                        return column.toString();
                    })
                    .forEach(verticals::add);

            this.startsVertical = getMatchedStarts(verticals);
            if (isSmudged) {
                this.smudgeStartsVertical = getStartsOffByOne(startsVertical, verticals);
            }
        }

        private List<Integer> getMatchedStarts(List<String> lines) {
            List<Integer> startIndixes = new ArrayList<>();
            for (int i = 0; i < lines.size() - 1; i++) {
                if (lines.get(i).equals(lines.get(i + 1))) {
                    startIndixes.add(i);
                }
            }
            return startIndixes.stream()
                    .sorted(Comparator.reverseOrder())
                    .collect(Collectors.toList());
        }

        private List<Integer> getStartsOffByOne(List<Integer> matchedStarts, List<String> lines) {
            List<Integer> startIndices = new ArrayList<>(matchedStarts);
            for (int i = 0; i < lines.size() - 1; i++) {
                String currentLine = lines.get(i);
                String nextLine = lines.get(i + 1);

                if (offByCount(currentLine, nextLine, 1)) {
                    startIndices.add(i);
                }
            }
            return startIndices.stream()
                    .sorted(Comparator.reverseOrder())
                    .collect(Collectors.toList());
        }

        public List<String> getHorizontals() {
            return horizontals;
        }

        public List<String> getVerticals() {
            return verticals;
        }

        public List<Integer> getStartsHorizontal() {
            return startsHorizontal;
        }

        public List<Integer> getStartsVertical() {
            return startsVertical;
        }

        public List<Integer> getSmudgeStartsHorizontal() {
            return getStartsOffByOne(startsHorizontal, horizontals);
        }

        public List<Integer> getSmudgeStartsVertical() {
            return smudgeStartsVertical;
        }

        public int getHorizontalCount() {
            return horizontalCount;
        }

        public int getVerticalCount() {
            return verticalCount;
        }

        public void setHorizontalCount(int horizontalCount) {
            this.horizontalCount = horizontalCount;
        }

        public void setVerticalCount(int verticalCount) {
            this.verticalCount = verticalCount;
        }
    }

    public static boolean offByCount(String a, String b, int expectedCount) {
        return Math.abs(a.length() - b.length()) <= 1 &&
                IntStream.range(0, Math.min(a.length(), b.length()))
                        .filter(i -> a.charAt(i) != b.charAt(i))
                        .count() == expectedCount;
    }

    private static void processStarts(boolean isSmudged) {
        valleys.forEach(valley -> {

            List<Integer> horizontalIndices = isSmudged ?
                    valley.getSmudgeStartsHorizontal() :
                    valley.getStartsHorizontal();
            int horizontalCount = processStarts(horizontalIndices, valley.getHorizontals(), isSmudged);

            valley.setHorizontalCount(horizontalCount);

            if (horizontalCount == 0) {
                valley.loadVerticals(isSmudged);
                List<Integer> verticalIndices = isSmudged ?
                        valley.getSmudgeStartsVertical() :
                        valley.getStartsVertical();
                int verticalCount = processStarts(verticalIndices, valley.getVerticals(), isSmudged);

                valley.setVerticalCount(verticalCount);
            }
        });
    }

    private static int processStarts(List<Integer> indices, List<String> lines, boolean isSmudged) {
        int count = 0;
        for (int index : indices) {
            List<String> front = new ArrayList<>();
            List<String> back = new ArrayList<>();
            if (index < (lines.size() - 1) / 2) {
                back.addAll(lines.subList(0, index + 1));
                front.addAll(lines.subList(index + 1, index + 1 + back.size()));
            } else {
                front.addAll(lines.subList(index + 1, lines.size()));
                back.addAll(lines.subList(index + 1 - front.size(), index + 1));
            }
            Collections.reverse(front);
            boolean countItV = isSmudged ?
                    offByCount(String.join("", front), String.join("", back), 1) :
                    offByCount(String.join("", front), String.join("", back), 0);
            if (countItV) {
                count += index + 1;
            }
        }
        return count;
    }

    private static List<Valley> valleys;

    public static void main(int part, boolean isDemo) {
        long startTime = System.nanoTime();
        int expectedResult;

        String dataString = isDemo ? DEMO_DATA : DATA;
        valleys = new ArrayList<>();
        Arrays.stream(dataString.split("\n\n")).map(Valley::new).forEach(valleys::add);

        if (part == 1) {
            expectedResult = isDemo ? EXPECTED_RESULT_DEMO_PART_ONE : EXPECTED_RESULT_PART_ONE;
            processStarts(false);
        } else {
            expectedResult = isDemo ? EXPECTED_RESULT_DEMO_PART_TWO : EXPECTED_RESULT_PART_TWO;
            processStarts(true);
        }

        int actualResult = valleys.stream()
                .mapToInt(valley -> (100 * valley.getHorizontalCount()) + valley.getVerticalCount())
                .sum();

        Utils.publishResult(startTime, expectedResult, actualResult);
    }
}
